version: 2.1

executors:
  nix-executor:
    resource_class: medium+
    docker:
      - image: nixos/nix

jobs:
  # Precompile all the rust dependencies
  compile:
    executor: nix-executor
    steps:
      - run: echo "compile job in rust-rep 123"
      
  test:
    executor: nix-executor
    steps:
      - run: echo "test job in rust-rep"

  staging:
    executor: nix-executor
    steps:
      - run: echo "staging job in rust-rep"

# We only want to trigger this workflow on tags, not pushes to branches.
workflows:
  build:
    jobs:
      - test

      - compile

      - staging:
          requires:
            - compile
            - test
